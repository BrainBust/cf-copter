/**
 * mc-ping
 * Copyright (c) 2013 David White
 * MIT Licensed
 **/
"use strict";
var net = require("net");

var ping = function(server, port, callback) {
	if (port === undefined) {
		port = 25565;
	}

	var socket = net.connect({
		port: port,
		host: server
	}, function() {
		var buf = new Buffer(2);
		buf[0] = 254;
		buf[1] = 1;
		socket.write(buf);
	});
    socket.setTimeout(2500, function() {
		callback("Connection Timed Out" , null);
		socket.end();
		socket.destroy();
    });
	socket.on("data", function(data) {
		var newdata = [];
		if (data[0] == 255) { // Server's magic response

			if (callback !== undefined) {
				data = {};
				data.code = true;
				callback(null, data);
			}
		} else {
			callback("Unexpected data from server", null);
		}
		socket.end();
		socket.destroy();
	});

	socket.on('error', function(e) {
		if (callback !== undefined) {
			callback(e, null);
		}
		socket.end();
		socket.destroy();
	});
};

module.exports = ping;